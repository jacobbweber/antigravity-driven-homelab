
# Master Guide: Spec-Driven Development with Antigravity & GitHub Spec Kit
**Created for:** Antigravity Driven Homelab Project
**Environment:** Windows (PowerShell) + Google Antigravity + Hyper-V

---

## 1. Core Concepts

### The "Why"
Traditional development often jumps straight to coding ("vibe coding"), leading to messy, unmaintainable software. **Spec-Driven Development (SDD)** inverts this by forcing you to define the **What** (Spec) and **How** (Plan) before the AI writes a single line of code.

### The Tooling
* **Antigravity:** The "Engine" (IDE + Agent). It executes the work.
* **GitHub Spec Kit:** The "Manual" (Protocol). It provides the structure (`.specify` folder) and rules the agent must follow.

---

## 2. Setup & Initialization (Windows/PowerShell)

Since standard installers (`uvx`) may fail on Windows/PowerShell, use this **Manual Initialization** method.

### A. Folder Structure
Create the following hierarchy in your project root:
```text
/my-project
  ├── AGENTS.md                 # Instructions for the AI
  ├── .specify/                 # The SDD "Brain" folder
  │   ├── constitution.md       # The Laws of the project
  │   ├── spec.md               # The Requirements (Generated by AI)
  │   ├── plan.md               # The Tech Stack & Files (Generated by AI)
  │   └── templates/            # (Empty folder for future use)
````

### B. Core File: `AGENTS.md`

*Place this in the root.* This file teaches Antigravity how to use the Spec Kit slash commands.


# Agent Instructions for Antigravity

You are an expert software engineer following Spec-Driven Development (SDD).

## Your Interaction Protocol
When I give you a command, you must follow the specific workflow below.

### 1. /speckit.constitution
- **Action:** Read `.specify/constitution.md`.
- **Goal:** Internalize the project's governing laws.
- **Output:** Confirm you have read and understood the principles.

### 2. /speckit.specify
- **Action:** Read the user's prompt and draft a requirements file at `.specify/spec.md`.
- **Goal:** define the "What" and "Why".
- **Rules:** Focus on user stories. Do NOT discuss technical implementation yet.

### 3. /speckit.plan
- **Action:** Read `.specify/spec.md` and create a technical plan at `.specify/plan.md`.
- **Goal:** Define the "How".
- **Rules:** Choose tech stack, define file structure, verify against Spec.

### 4. /speckit.implement
- **Action:** Read `.specify/plan.md` and generate the actual code files.
- **Goal:** Build the software.
- **Rules:** Create files exactly as planned. Update checklists.
```

### C. Core File: `.specify/constitution.md`

*The "Supreme Court" of your project.*

```markdown
# Project Constitution

## 1. Core Philosophy
- **Spec-First:** No code is written without a corresponding specification and plan.
- **Idempotency:** All scripts must be safe to run multiple times (check before creating).
- **Simplicity:** Prefer simple, readable solutions ("Boring is good").

## 2. Coding Standards
- **Language:** PowerShell for Infrastructure, Python (Flask) for Backend.
- **Error Handling:** Fail loudly and explicitly. No silent failures.

## 3. AI Behavior Rules
- **Context Awareness:** Always read the current Spec and Plan before generating code.
```

-----

## 3\. The SDD Workflow (The Loop)

Every feature follows this exact cycle. Do not skip steps.

### Step 0: Prime the Agent

*Run this once per session.*

> "Please read `AGENTS.md` and `.specify/constitution.md`. Confirm when you are ready for SDD commands."

### Step 1: The Constitution

*Enforce the rules.*

> `/speckit.constitution`

### Step 2: The Specification (The "What")

*Define the goal.*

> `/speckit.specify`
> **Goal:** Build a dashboard to provision Hyper-V VMs.
> **Key Features:** One-click provision, One-click destroy, Live logs.

### Step 3: The Plan (The "How")

*Define the architecture. This is your safety check.*

> `/speckit.plan`
> **Tech Stack:** Python (Flask) + Vanilla JS + PowerShell.
> **Constraint:** Use `subprocess` to call PowerShell. No complex frontend frameworks.

*Creating the "Destroy" feature (Iteration):*

> `/speckit.plan`
> **Task:** Add destruction logic.
> **Requirements:** Create `destroy_lab.ps1` using `Remove-VM`. Ensure idempotency.

### Step 4: Implementation (The Code)

*Let the agent build.*

> `/speckit.implement`

### Step 5: Verification (The Test)

1.  **Manual Check:** Read the generated code (especially PowerShell).
2.  **Permissions:** Run the app as **Administrator**.
3.  **End-to-End:** Click the buttons in the Web UI and check Hyper-V Manager.

-----

## 4\. Technical Reference (Homelab Stack)

### A. PowerShell Script Pattern (Idempotency)

Notice the `if/else` check. This prevents errors if you run it twice.

```powershell
$vmName = "AG-Lab-Win"
if (Get-VM -Name $vmName -ErrorAction SilentlyContinue) {
    Write-Output "$vmName already exists. Skipping."
} else {
    New-VM -Name $vmName ...
}
```

### B. Python Flask Wrapper

The glue between Web and PowerShell.

```python
import subprocess
from flask import Flask, jsonify
from flask_cors import CORS

app = Flask(__name__)
CORS(app)  # REQUIRED for browser security

@app.route('/provision', methods=['POST'])
def provision():
    # Runs the script and captures output
    result = subprocess.run(["powershell", "scripts/provision.ps1"], capture_output=True, text=True)
    return jsonify({"output": result.stdout})
```

-----

## 5\. Troubleshooting & Pitfalls

| Issue | Cause | Fix |
| :--- | :--- | :--- |
| **`uvx` command not found** | Windows environment issues. | Use Manual Setup (create folders yourself). |
| **`ModuleNotFoundError: flask_cors`** | AI added a library but didn't install it. | Run `pip install flask-cors`. |
| **Button clicks do nothing** | Script lacks permissions to touch Hyper-V. | Run `python app.py` from an **Administrator** terminal. |
| **"Access Denied" in logs** | Hyper-V requires elevated privileges. | Ensure the user running the script is in the "Hyper-V Administrators" group or runs as Admin. |
| **Restricted/Red Buttons** | Feature was not in the Spec/Plan. | Don't hack it. Run the SDD loop: Update Spec -\> Update Plan -\> Implement. |

-----

## 6\. Next Steps (Level 2)

To advance this project, the next phase is **Parameterization**:

1.  Update Spec to allow User Input (e.g., "VM Name", "RAM Amount").
2.  Update Plan to pass these variables from HTML -\> Python -\> PowerShell arguments.
3.  Implement the dynamic scripts.

<!-- end list -->